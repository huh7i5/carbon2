<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ°å›¾è°ƒè¯•å·¥å…· - æ²ªç¢³æ™ºè„‘</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a252f;
            color: white;
        }
        
        .debug-container {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            height: calc(100vh - 100px);
        }
        
        #mapContainer {
            border: 2px solid #00d4aa;
            border-radius: 8px;
        }
        
        .debug-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .status {
            margin: 15px 0;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .status.loading {
            background: rgba(255, 193, 7, 0.1);
            border-color: #ffc107;
            color: #ffc107;
        }
        
        .status.success {
            background: rgba(0, 212, 170, 0.1);
            border-color: #00d4aa;
            color: #00d4aa;
        }
        
        .status.error {
            background: rgba(255, 107, 107, 0.1);
            border-color: #ff6b6b;
            color: #ff6b6b;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 15px;
            height: 300px;
            overflow-y: scroll;
            font-family: monospace;
            font-size: 12px;
            margin: 15px 0;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-entry.info { color: #a0a0a0; }
        .log-entry.success { color: #00d4aa; }
        .log-entry.warn { color: #ffc107; }
        .log-entry.error { color: #ff6b6b; }
        
        .control-btn {
            background: #00d4aa;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px 5px 5px 0;
            font-size: 12px;
        }
        
        .control-btn:hover {
            background: #007a8c;
        }
        
        .control-btn:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .info-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 212, 170, 0.05);
            border-radius: 4px;
        }
        
        .info-section h4 {
            margin: 0 0 10px 0;
            color: #00d4aa;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ åœ°å›¾è°ƒè¯•å·¥å…·</h1>
    <p>æ²ªç¢³æ™ºè„‘åœ°ç†ç©ºé—´åˆ†ææ¨¡å—è°ƒè¯•ç•Œé¢</p>
    
    <div class="debug-container">
        <div id="mapContainer"></div>
        
        <div class="debug-panel">
            <div id="status" class="status loading">
                æ­£åœ¨åˆå§‹åŒ–åœ°å›¾è°ƒè¯•å·¥å…·...
            </div>
            
            <div class="info-section">
                <h4>ğŸ“ é¢„æœŸæ ‡è®°ç‚¹</h4>
                <div id="expectedMarkers">
                    <div>ğŸ­ ä¸Šæµ·åŒ–å·¥å›­åŒºCO2æ•é›†æº</div>
                    <div>ğŸ—„ï¸ ä¸œæµ·CO2å°å­˜ç‚¹A</div>
                    <div>ğŸš› äº§å“è¿è¾“ä¸­å¿ƒ</div>
                    <div>ğŸ¢ åˆä½œåŒ–å·¥å‚B</div>
                </div>
            </div>
            
            <div class="info-section">
                <h4>ğŸ›ï¸ è°ƒè¯•æ§åˆ¶</h4>
                <button class="control-btn" onclick="reloadMap()">é‡æ–°åŠ è½½åœ°å›¾</button>
                <button class="control-btn" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
                <button class="control-btn" onclick="testMarkers()">æµ‹è¯•æ ‡è®°ç‚¹</button>
                <button class="control-btn" onclick="showMapInfo()">æ˜¾ç¤ºåœ°å›¾ä¿¡æ¯</button>
            </div>
            
            <div class="info-section">
                <h4>ğŸ“Š å®æ—¶ç»Ÿè®¡</h4>
                <div>åœ°å›¾çŠ¶æ€: <span id="mapStatus">æœªåˆå§‹åŒ–</span></div>
                <div>æ ‡è®°ç‚¹æ•°é‡: <span id="markerCount">0</span></div>
                <div>åˆå§‹åŒ–æ—¶é—´: <span id="initTime">-</span></div>
            </div>
            
            <h4>ğŸ“ è°ƒè¯•æ—¥å¿—</h4>
            <div id="debugLog" class="log"></div>
        </div>
    </div>
    
    <!-- é«˜å¾·åœ°å›¾APIå®‰å…¨å¯†é’¥é…ç½® -->
    <script type="text/javascript">
        window._AMapSecurityConfig = {
            securityJsCode: "6048d86b12ebfa706956ecda48abae64",
        };
    </script>
    
    <!-- é«˜å¾·åœ°å›¾API Loader -->
    <script src="https://webapi.amap.com/loader.js"></script>
    
    <!-- å¯¼å…¥é¡¹ç›®è„šæœ¬ -->
    <script src="src/main/frontend/js/config.js"></script>
    <script src="src/main/frontend/js/mockData.js"></script>
    <script src="src/main/frontend/js/map.js"></script>
    
    <script>
        let initStartTime = Date.now();
        
        // é‡å†™consoleæ–¹æ³•ä»¥æ•è·æ—¥å¿—
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.log = (...args) => {
            originalLog.apply(console, args);
            addLogEntry('info', args.join(' '));
        };
        
        console.warn = (...args) => {
            originalWarn.apply(console, args);
            addLogEntry('warn', args.join(' '));
        };
        
        console.error = (...args) => {
            originalError.apply(console, args);
            addLogEntry('error', args.join(' '));
        };
        
        function addLogEntry(type, message) {
            const log = document.getElementById('debugLog');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function updateStats() {
            document.getElementById('mapStatus') = window.MapManager?.isInitialized ? 'å·²åˆå§‹åŒ–' : 'æœªåˆå§‹åŒ–';
            document.getElementById('markerCount').textContent = window.MapManager?.markers?.length || 0;
            
            if (window.MapManager?.isInitialized) {
                const initTime = (Date.now() - initStartTime) / 1000;
                document.getElementById('initTime').textContent = `${initTime.toFixed(2)}ç§’`;
            }
        }
        
        function reloadMap() {
            updateStatus('é‡æ–°åŠ è½½åœ°å›¾ä¸­...', 'loading');
            if (window.MapManager) {
                window.MapManager.destroy();
                setTimeout(() => {
                    initStartTime = Date.now();
                    window.MapManager.init();
                }, 1000);
            }
        }
        
        function clearLog() {
            document.getElementById('debugLog').innerHTML = '';
        }
        
        function testMarkers() {
            if (!window.MapManager?.isInitialized) {
                addLogEntry('warn', 'åœ°å›¾æœªåˆå§‹åŒ–ï¼Œæ— æ³•æµ‹è¯•æ ‡è®°ç‚¹');
                return;
            }
            
            const markers = window.MapManager.markers;
            addLogEntry('info', `å½“å‰æ ‡è®°ç‚¹æ•°é‡: ${markers.length}`);
            
            markers.forEach((marker, index) => {
                addLogEntry('info', `æ ‡è®°ç‚¹ ${index + 1}: ${marker.getTitle()} at ${marker.getPosition()}`);
            });
        }
        
        function showMapInfo() {
            if (!window.MapManager?.map) {
                addLogEntry('warn', 'åœ°å›¾å®ä¾‹ä¸å­˜åœ¨');
                return;
            }
            
            const map = window.MapManager.map;
            addLogEntry('info', `åœ°å›¾ä¸­å¿ƒç‚¹: ${map.getCenter()}`);
            addLogEntry('info', `åœ°å›¾ç¼©æ”¾çº§åˆ«: ${map.getZoom()}`);
            addLogEntry('info', `åœ°å›¾è¾¹ç•Œ: ${map.getBounds()}`);
        }
        
        // åˆå§‹åŒ–
        async function init() {
            try {
                updateStatus('åˆå§‹åŒ–MockData...', 'loading');
                window.MockData.init();
                
                updateStatus('åˆå§‹åŒ–åœ°å›¾ç®¡ç†å™¨...', 'loading');
                await window.MapManager.init();
                
                updateStatus('åœ°å›¾åˆå§‹åŒ–æˆåŠŸï¼', 'success');
                
                // å®šæ—¶æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
                setInterval(updateStats, 1000);
                
            } catch (error) {
                updateStatus(`åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
        
        // æ·»åŠ åˆå§‹æ—¥å¿—
        addLogEntry('info', 'åœ°å›¾è°ƒè¯•å·¥å…·å·²å¯åŠ¨');
    </script>
</body>
</html>